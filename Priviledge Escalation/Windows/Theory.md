
### **Who generates the access token?**

- When a user (or process) logs on, the **Local Security Authority Subsystem Service (LSASS)** is responsible for authentication and token creation.
- Steps:
    1. You type your credentials 
    2. LSASS verifies them with the appropriate authentication provider ( Kerberos for domains, NTLM for local).
    3. Once verified, LSASS asks the **Security Reference Monitor (SRM)** (a kernel component) to create an **access token**.
    4. That token contains:
        - The user’s SID
        - Group SIDs (e.g., Administrators, Domain Users)
        - Privileges (SeDebugPrivilege, SeShutdownPrivilege, etc.)
        - Restrictions (integrity levels, session info, etc.)


### **How is the token checked?**

When you try to access a secured object (file, registry key, printer, etc.):

1. The object has a **DACL (Discretionary Access Control List)** attached to it.
    - A DACL contains **ACEs (Access Control Entries)** that map permissions to **SIDs**.


2. The **SRM (Security Reference Monitor)** compares:
    - Your access token (your SID + groups + privileges)
    - Against the object’s DACL entries.
        
3. If any ACE in the DACL grants you the requested permission, access is allowed.
    - Example: If your token contains `S-1-5-32-544` (Administrators group), and the file’s DACL grants full control to that SID, you’re in.


 SIDs are generated by different components depending on the situation:

  - The SID for local accounts and groups is generated by the *Local
    Security Authority* (LSA).

  - The SID for domain users and domain groups is generated by the
    *Domain Controller* (DC).

  SIDs are used by Windows to identify security principals for access
  control management

When a user starts a process or thread, a token will be assigned to
  these objects. The token is called a `primary token' and it specifies
  the permissions of the process or thread.

  Processes and threads can also have an `impersonation token'
  assigned. They are used to change the security context than the
  process that owns the thread.


### Windows Permissions 


  An Access Control Entry (ACE) si an individual permission rule which
  controls the individual permissions of a security principal on a file
  object. These are the following high-level permissions for an ACL:

  - Fully Access (F)
  - Modify Access (M)
  - Read and Execute Access (RX)
  - Read-Only Access (R)
  - Write-Only Access (W)

  There are more advanced permissions too that deal with inheritance
  rights, which only apply to directories.

  - (OI) Object Inerit
  - (CI) Container Inherit
  - (IO) Inherit Only
  - (NP) Do not propagate inherit
  - (I) Permission inherited from parent container



### Windows Services

Basically  programs that execute without user interaction and continue even aftert user logged off.

its like daemon in linux based OS


there area different type of services: 
- local service
- network service
- system service
- third pary app



### Mandatory Integrity Control "MIC"

provides a mechanism for controlling access to securable objects. this mechanism is in addition to access control 

when processes are started  or objects are created they receive the integrity level of the principal performing this operation.

when the user attempts to launch an executable file,  the new process is created with the minimum of the user integrity level  and the file integrity level.


### Mimikatz

Main Features of Mimikatz:
- **Export credentials**: Can export plaintext passwords, NTLM hashes, Kerberos tickets, and pins from memory.
- **Pass-the-hash**: Allows you to use NTLM password hashes to authenticate without needing the actual password.
- **Pass-the-ticket**: Allows the use of Kerberos tickets for authentication to other services on the network.
- **Golden and Silver tickets**: Generate Kerberos tickets that allow continued access to networks, even if passwords change.
- **Over-pass-the-hash (Pass-the-key)**: Uses NTLM hashes and Kerberos keys to authenticate to systems.
- **Run on local and remote system**: Can be used to extract credentials from either local or remote systems.
- **Escalation of privileges**: Used to gain higher access rights to a system.

Understanding Mimikatz’s Modules
- **sekurlsa**: Used to extract credentials from system security processes (LSASS) memory. It can extract plaintext passwords, hashes, and Kerberos tickets.
- **Privilege**: Used to obtain the necessary privileges (eg SeDebugPrivilege) so that it can run at elevated privileges to extract credentials.
- **crypto**: Provides access to cryptographic functions such as certificate and private key management, which can be used for various attacks.
- **kerberos**: Used to manage and exploit Kerberos tickets. Includes creating golden and silver tickets for extended access.
- **tgt**: Allows TGTs (Ticket Granting Tickets) to be extracted and managed from memory for pass-the-ticket attacks.
- **lsadump**: Used to extract information from Security Account Manager (SAM) and Active Directory database.
- **sid**: Manages and changes SID (Security Identifier), which can be used to bypass security policies.


What the SAM file is
- **SAM** = _Security Account Manager_. It’s a Windows registry hive/database that stores **local** account information (usernames and password hashes) for that machine. The on-disk file lives under `%SystemRoot%\System32\config\SAM` and is mounted into the registry as `HKLM\SAM`. Windows and LSA use it to validate local logons. [picussecurity.com+1](https://www.picussecurity.com/resource/the-mitre-attck-t1003-os-credential-dumping-technique-and-its-adversary-use?utm_source=chatgpt.com)
    

What LSA and LSASS are
- **LSA (Local Security Authority)** is the Windows subsystem responsible for authentication decisions, local security policy, and managing some sensitive secrets (cached credentials, certain keys, LSA secrets). It’s a conceptual component of Windows security. [Microsoft Learn](https://learn.microsoft.com/en-us/windows-server/security/windows-authentication/credentials-processes-in-windows-authentication?utm_source=chatgpt.com)
    
- **LSASS (Local Security Authority Subsystem Service)** is the _process_ that implements LSA functionality: `lsass.exe`. LSASS holds lots of sensitive material in memory (credential material, Kerberos tickets, NTLM hashes, etc.), which makes it a high-value target for attackers. [Microsoft Learn+1](https://learn.microsoft.com/en-us/windows-server/security/windows-authentication/credentials-processes-in-windows-authentication?utm_source=chatgpt.com)
    
 What `token::elevate` in Mimikatz means (high level)
 
 - Windows uses **access tokens** to describe the identity/privileges of a process or thread (user SIDs, group membership, privileges).
    
- `token::elevate` in Mimikatz is a module that **tries to obtain and impersonate a more-privileged access token** (for example a SYSTEM token, LocalService/NetworkService, Domain Admin, etc.) and then run actions under that elevated security context. In short: it’s about _token impersonation/elevation_ — not magic escalation, but reusing an already available token to perform privileged actions. (Because it switches the security context, it’s commonly used before other credential-dump operations.)