
### **Who generates the access token?**

- When a user (or process) logs on, the **Local Security Authority Subsystem Service (LSASS)** is responsible for authentication and token creation.
- Steps:
    1. You type your credentials 
    2. LSASS verifies them with the appropriate authentication provider ( Kerberos for domains, NTLM for local).
    3. Once verified, LSASS asks the **Security Reference Monitor (SRM)** (a kernel component) to create an **access token**.
    4. That token contains:
        - The user’s SID
        - Group SIDs (e.g., Administrators, Domain Users)
        - Privileges (SeDebugPrivilege, SeShutdownPrivilege, etc.)
        - Restrictions (integrity levels, session info, etc.)


### **How is the token checked?**

When you try to access a secured object (file, registry key, printer, etc.):

1. The object has a **DACL (Discretionary Access Control List)** attached to it.
    - A DACL contains **ACEs (Access Control Entries)** that map permissions to **SIDs**.


2. The **SRM (Security Reference Monitor)** compares:
    - Your access token (your SID + groups + privileges)
    - Against the object’s DACL entries.
        
3. If any ACE in the DACL grants you the requested permission, access is allowed.
    - Example: If your token contains `S-1-5-32-544` (Administrators group), and the file’s DACL grants full control to that SID, you’re in.


 SIDs are generated by different components depending on the situation:

  - The SID for local accounts and groups is generated by the *Local
    Security Authority* (LSA).

  - The SID for domain users and domain groups is generated by the
    *Domain Controller* (DC).

  SIDs are used by Windows to identify security principals for access
  control management

When a user starts a process or thread, a token will be assigned to
  these objects. The token is called a `primary token' and it specifies
  the permissions of the process or thread.

  Processes and threads can also have an `impersonation token'
  assigned. They are used to change the security context than the
  process that owns the thread.


### Windows Permissions 


  An Access Control Entry (ACE) si an individual permission rule which
  controls the individual permissions of a security principal on a file
  object. These are the following high-level permissions for an ACL:

  - Fully Access (F)
  - Modify Access (M)
  - Read and Execute Access (RX)
  - Read-Only Access (R)
  - Write-Only Access (W)

  There are more advanced permissions too that deal with inheritance
  rights, which only apply to directories.

  - (OI) Object Inerit
  - (CI) Container Inherit
  - (IO) Inherit Only
  - (NP) Do not propagate inherit
  - (I) Permission inherited from parent container



### Windows Services

Basically  programs that execute without user interaction and continue even aftert user logged off.

its like daemon in linux based OS


there area different type of services: 
- local service
- network service
- system service
- third pary app



### Mandatory Integrity Control "MIC"

provides a mechanism for controlling access to securable objects. this mechanism is in addition to access control 

when processes are started  or objects are created they receive the integrity level of the principal performing this operation.

when the user attempts to launch an executable file,  the new process is created with the minimum of the user integrity level  and the file integrity level.